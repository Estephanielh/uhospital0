<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link rel="stylesheet" href="styles.css">
    <title>Crear Cuenta | UHospital</title>
</head>
<form class="black form" id="signupForm">
    <h1>Crear Cuenta</h1>
    <label for="nombre">Nombre *</label><br>
    <input id="nombre" required>
    <br><br>
    <label for="apellido">Apellido *</label><br>
    <input id="apellido" required>
    <br><br>
    <label for="dob">Fecha de Nacimiento *</label><br>
    <input id="dob" required>
    <br><br>
    <label for="sexo">Sexo *</label><br>
    <input id="sexo" required>
    <br><br>
    <label for="usuario">Nombre de Usuario *</label><br>
    <input id="usuario" required>
    <br><br>
    <label for="contra">Contraseña *</label><br>
    <input type="password" id="contra" minlength="8" required>
    <br><br>
    <label for="tel">Teléfono</label><br>
    <input id="tel">
    <br><br><br>
    <button class="largebutton" id="signupButton">Crear Cuenta</button>
    <br><br>
    <p>¿Ya tienes una cuenta?</p>
    <a href="login.html" class="abutton buttonblack" style="width: 93%;">Iniciar Sesión</a>
</form>
<script>
    let signupForm = document.getElementById("signupForm");
    let signupFirstName = document.getElementById("nombre");
    let signupLastName = document.getElementById("apellido");
    let signupBornDate = document.getElementById("dob");
    let signupGender = document.getElementById("sexo");
    let signupNickname = document.getElementById("usuario");
    let signupPassword = document.getElementById("contra");
    let signupPhone = document.getElementById("tel");
    let signupButton = document.getElementById("signupButton");
    signupForm.addEventListener("submit", (e) => {
        e.preventDefault();
    });
    signupButton.addEventListener("click", (e) => {
        const newUser = {
            first_name: signupFirstName.value,
            last_name: signupLastName.value,
            date: signupBornDate.value,
            gender: signupGender.value,
            nickname: signupNickname.value,
            password: signupPassword.value,
            phone: signupPhone.value,
        };
        if (newUser.first_name == "" || newUser.last_name == "" || newUser.date == "" || newUser.gender == "" || newUser.nickname == "" || newUser.password.length < 8) {
            alert("Ingresa los campos obligatorios");
            return false;
        }
        console.log(newUser);
        fetch("https://uhospital0.herokuapp.com/signup", {
                method: "POST",
                headers: {
                    "content-type": "application/json",
                },
                body: JSON.stringify(newUser),
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.message) {
                    console.error(data);
                } else {
                    let params = `first_name=${data.first_name}`;
                    params += `&last_name=${data.last_name}`;
                    params += `&date=${data.date}`;
                    params += `&gender=${data.gender}`;
                    params += `&nickname=${data.nickname}`;
                    params += `&password=${data.password}`;
                    params += `&phone=${data.phone}`;
                    params += "&type=2";
                    window.location = "dashboard paciente.html?" + params;
                }
            })
            .catch((error) => console.error(error));
    });
</script>
</body>

</html>